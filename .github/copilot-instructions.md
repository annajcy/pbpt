# PBPT (Physically Based Path Tracer) Agent Instructions

This document provides instructions for AI agents working on the PBPT codebase.

## Project Overview

PBPT is a physically based path tracer written in C++23. It uses CMake for its build system and Conan for dependency management. The primary goal of the project is to render 3D scenes with high-fidelity lighting and materials.

The core rendering logic is located in `src/`. The directory is organized by functionality:
- `src/camera`: Film, camera models, and rendering transformations.
- `src/geometry`: Geometric primitives (e.g., spheres, triangles) and acceleration structures.
- `src/integrator`: Different path tracing integrators.
- `src/math`: Core math utilities (vectors, matrices, etc.).
- `src/radiometry`: Spectrum, BSDFs, and other radiometric quantities.

## Developer Workflow

### Dependencies

All C++ dependencies are managed through `conanfile.py`. Key libraries include:
- `vulkan-loader`, `glfw`: For display and windowing.
- `imgui`: For the graphical user interface.
- `assimp`: For loading 3D model assets.
- `stb`: For image loading/saving.
- `gtest`: For unit tests.
- `slang`: A custom-built dependency for a shading language.

### Building the Project

The recommended way to build the project is using Conan.

1.  **Install dependencies and configure the build:**
    ```bash
    conan install . --build=missing
    ```

2.  **Build the project:**
    This command configures the project using CMake presets generated by Conan and then builds it.
    ```bash
    cmake --build build --preset conan-default
    ```

    Alternatively, you can use `conan build .` which combines the installation and build steps.

### Build Configuration

The build can be customized using options in `conanfile.py` or by passing them to CMake. The main options are:
- `PBPT_BUILD_TESTS`: Build tests (default: ON).
- `PBPT_BUILD_EXAMPLES`: Build examples (default: ON).
- `PBPT_FLOAT_64BIT`: Use `double` instead of `float` for floating-point types (default: OFF).

### Running Tests

Tests are built if `PBPT_BUILD_TESTS` is ON. You can run them using CTest from the build directory:
```bash
cd build
ctest
```

### Code Generation

The project uses a Python script `py_script/merge_cpp_files.py` to merge multiple `.cpp` files into a single file for each `src` subdirectory (e.g., `src/camera/merged_sources.txt`). This is part of the CMake build process and happens automatically. When adding a new `.cpp` file, you may need to ensure it is correctly picked up by this process, which is handled by the `CMakeLists.txt` in each subdirectory.

## Conventions

- The project uses C++23 features.
- Header files generally use the `.hpp` extension for C++ headers, and `.h` for C-style headers or headers that are part of the public API.
- The codebase is organized into namespaces corresponding to the directory structure (e.g., `pbpt::camera`).
- `compile_commands.json` is generated in the `build/` directory, which can be used by various editor tools for code completion and navigation.
